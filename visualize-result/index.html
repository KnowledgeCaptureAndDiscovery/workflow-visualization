<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<!-- <link rel="icon" type="image/png" href=""> -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Workflow Dashboard</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
	<meta name="viewport" content="width=device-width" />

	<!-- Icons -->
	<link rel="stylesheet" href="../assets/css/pe-icon-7-stroke.css"/>

	<!-- Semantic UI CSS -->
	<link rel="stylesheet" href="../assets/css/semantic.min.css"/>

	<!-- Custom Stylesheet -->
	<link rel="stylesheet" href="../global.css"/>
	<link rel="stylesheet" href="styles.css"/>

	<!-- Range Slider Plugin -->
	<link rel="stylesheet" href="../assets/css/range.normalize.css">
	<link rel="stylesheet" href="../assets/css/range.css">
	<link rel="stylesheet" href="../assets/css/range.skinFlat.css">
</head>

<body class="dimmable" style="display: none">

	<!-- Sidebar Menu for Mobile Sites -->
	<div class="ui left vertical inverted sidebar menu blue toc">
		<a href="../" class="item title">
			<b>Workflow</b>
		</a>
		<a class="item active">
			<i class="pe-7s-graph"></i> <span>Visualize Result</span>
		</a>
		<a href="../inspect-parameters/" class="item">
			<i class="pe-7s-edit"></i> <span>Inspect Parameters</span>
		</a>
		<a href="../compare-workflows/" class="item">
			<i class="pe-7s-graph3"></i> <span>Compare Workflows</span>
		</a>
	</div>

	<!-- Navigation Bar for Mobile Sites -->
	<div class="ui fixed inverted main menu">
		<div class="ui container">
			<a class="launch icon item">
				<i class="content icon"></i>
			</a>
	
			<div class="item">
				Visualize Result
			</div>
		</div>
	</div>

	<!-- Main Content -->
	<div class="pusher full height">
		<!-- The Real Main Content -->
		<div class="main-content">
			<!-- Main Content Header -->
			<div class="ui vertical segment header-content">
				<div class="ui container">
					<div class="ui stackable grid">
						<div class="nine wide column">
							<h1 class="ui header">
							Visualize Result
							</h1>
						</div>
						<div class="seven wide column">
							<div class="ui small basic buttons">
								<div class="ui fluid pointing dropdown button header-dropdown">
									<span class="text">Data Selection</span>
									<i class="icon dropdown"></i>
									<div class="menu">
										<div class="header"> Sample CSV Data </div>
										<div class="item" data-value="https://vincentarelbundock.github.io/Rdatasets/csv/datasets/iris.csv">Iris</div>
										<div class="item" data-value="https://vincentarelbundock.github.io/Rdatasets/csv/datasets/infert.csv">Infertility</div>
										<div class="item" data-value="https://vincentarelbundock.github.io/Rdatasets/csv/datasets/airquality.csv">Missing Values</div>

										<div class="divider"></div>

										<div class="header"> Sample ARFF Data </div>
										<div class="item" data-value="https://yjy0625.github.io/workflow-visualization/data/contact-lenses.arff">Contact Lenses</div>
										<div class="item" data-value="https://yjy0625.github.io/workflow-visualization/data/diabetes.arff">Diabetes</div>

										<div class="divider"></div>

										<div class="header"> Biodata </div>
										<div class="item" data-value="https://yjy0625.github.io/workflow-visualization/data/heatMapData">Heatmap Data</div>
										<div class="item" data-value="https://yjy0625.github.io/workflow-visualization/data/biodata-md.tsv">Biodata (3.8MB)</div>
										<div class="item" data-value="https://yjy0625.github.io/workflow-visualization/data/biodata-lg.tsv">Biodata (9.9MB)</div>

										<div class="divider"></div>

										<div class="header"> Other Options </div>
										<div class="item" data-value="upload">Upload Data</div>
									</div>
								</div>
								<button class="ui icon look disabled button">
									<i class="download icon"></i>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="ui vertical segment sample-notice hidden">
				<div class="ui container">
					<div class="notice-content">
						<i class="info circle icon"></i> Due to the size of the data, only a set of sample data is rendered in some visualizations. If you want to view all data in those visualizations, turn the switch "show all data" on. The rendering process might be very slow.
					</div>
				</div>
			</div>

			<!-- Graph Content -->
			<div class="ui vertical segment dimmable">
				<div class="graphs">
					<div class="ui doubling stackable three column masonry grid graph-content">
						<!-- Different Graph Modules Start Here -->

						<div class="column settings">
							<div class="ui fluid card">
								<div class="content">
									<div class="header">
										Settings
									</div>
									<div class="meta">
										Visualization customization.
									</div>
								</div>
								<div class="content">
									<span>Modules</span>
									<div class="ui grid">
										<div class="sixteen wide column not-masonry">
											<div class="ui basic add module buttons">
												<div class="ui fluid add module pointing dropdown button">
													<span class="text">Select Module</span>
													<i class="icon dropdown"></i>
													<div class="menu"></div>
												</div>
												<button class="ui add module button">Add Module</button>
											</div>
										</div>
										<div class="eight wide column not-masonry">
											<button class="ui basic fluid restore default button">Restore Default</button>
										</div>
										<div class="eight wide column not-masonry">
											<button class="ui basic fluid clear modules button">Clear Modules</button>
										</div>
									</div>
								</div>
								<div class="content">
									<span>Layout</span>
									<div class="ui two column grid">
										<div class="column not-masonry">
											<button class="ui basic fluid fold all button">Fold All</button>
										</div>
										<div class="column not-masonry">
											<button class="ui basic fluid unfold all button">Unfold All</button>
										</div>
									</div>
								</div>
								<div class="content">
									<span>Linking</span>
									<div class="column not-masonry">
										<button class="ui basic fluid disabled link button">Coming Soon</button>
									</div>
								</div>
							</div>
						</div>

						<div class="column basic">
							<div class="ui fluid card">
								<div class="content">
									<div class="header">
										Basic Information
									</div>
									<div class="meta">
										Basic statistical information of the data.
									</div>
								</div>
								<div class="content has-statistics">
									<span>Column and Row Count</span>
									<div class="ui two statistics">
										<div class="ui statistic col-count">
											<div class="value">-</div>
											<div class="label">Columns</div>
										</div>
										<div class="ui statistic row-count">
											<div class="value">-</div>
											<div class="label">Data Points</div>
										</div>
									</div>
								</div>
								<div class="content">
									<div class="toggle-container">
										<div>Column Summary</div>
										<div class="ui fitted toggle checkbox">
											<input type="checkbox">
											<label></label>
										</div>
									</div>
									<table class="ui basic unstackable table">
										<thead>
											<th>Column Name</th>
											<th>Data Type</th>
										</thead>
										<tbody class="col-type">
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<div class="column univariate">
							<div class="ui fluid card">
								<div class="content">
									<div class="header">
										Univariate Analysis
									</div>
									<div class="meta">
										Basic statistics and distribution analysis of a single column in the data.
									</div>
									<div class="col-dropdown">
										<select class="ui fluid dropdown">
											<option value="">Select Column</option>
										</select>
									</div>
								</div>
								<div class="content missing-notice"></div>
								<div class="content has-menu">
									<div class="ui secondary pointing two item menu">
										<a class="active item">Box Plot</a>
										<a class="item">Histogram</a>
										<a class="item">Pie Chart</a>
										<a class="item">Column Chart</a>
									</div>
									<div class="box-plot">
										<div class="chart image"></div>
										<table class="ui basic unstackable table">
											<thead>
												<th>Property</th>
												<th>Value</th>
											</thead>
											<tbody></tbody>
										</table>
									</div>
									<div class="histogram">
										<div class="chart image"></div>
										<div class="ui divider"></div>
										<span>Number of Bins</span>
										<input class="ui range"></input>
										<div class="ui divider"></div>
										<div class="toggle-container exclude">
											<div>Exclude Outliers</div>
											<div class="ui fitted toggle checkbox">
												<input type="checkbox">
												<label></label>
											</div>
										</div>
										<div class="meta exclude-detail"></div>
										<div class="ui divider"></div>
										<div class="toggle-container perc">
											<div>Show Percentage Instead</div>
											<div class="ui fitted toggle checkbox">
												<input type="checkbox">
												<label></label>
											</div>
										</div>
									</div>
									<div class="pie-chart">
										<div class="chart image"></div>
									</div>
									<div class="column-chart">
										<div class="chart image"></div>
									</div>
								</div>
							</div>
						</div>

						<div class="column bivariate">
							<div class="ui fluid card">
								<div class="content">
									<div class="header">
										Bivariate Analysis
									</div>
									<div class="meta">
										Comparison and relationship analysis on two columns of data.
									</div>
									<div class="col-dropdown">
										<select class="ui fluid dropdown">
											<option value="">Select Column</option>
										</select>
										<div class="ui horizontal divider">
											<i class="resize vertical switch icon"></i>
										</div>
										<select class="ui fluid dropdown">
											<option value="">Select Column</option>
										</select>
									</div>
								</div>
								<div class="content missing-notice"></div>
								<div class="content has-menu">
									<div class="ui secondary pointing two item menu">
										<a class="active item">Heatmap</a>
										<a class="item">Scatter Plot</a>
										<a class="item">Line Chart</a>
										<a class="item">Stacked Histogram</a>
										<a class="item">Donut Chart</a>
										<a class="item">Stacked Column Chart</a>
									</div>
									<div class="heatmap">
										<div class="chart image"></div>
										<div class="ui divider"></div>
										<span>X-Axis Ticks</span>
										<input class="ui range"></input>
										<div class="ui divider"></div>
										<span>Y-Axis Ticks</span>
										<input class="ui range"></input>
									</div>
									<div class="scatter-plot">
										<div class="chart image"></div>
										<div class="ui divider"></div>
										<div class="toggle-container">
											<div>Regression</div>
											<div class="ui fitted toggle checkbox">
												<input type="checkbox">
												<label></label>
											</div>
										</div>
										<select class="ui fluid dropdown">
											<option value="linear">Linear</option>
											<option value="polynomial">Quadratic</option>
											<option value="exponential">Exponential</option>
											<option value="logarithmic">Logarithmic</option>
											<option value="power">Power</option>
										</select>
									</div>
									<div class="line-chart">
										<div class="chart image"></div>
									</div>
									<div class="stacked-histogram">
										<div class="chart image"></div>
										<div class="ui divider"></div>
										<span>Number of Bins</span>
										<input class="ui range"></input>
									</div>
									<div class="donut-chart">
										<div class="chart image"></div>
									</div>
									<div class="stacked-column-chart">
										<div class="chart image"></div>
									</div>
								</div>
							</div>
						</div>

						<div class="column trivariate">
							<div class="ui fluid card">
								<div class="content">
									<div class="header">
										Trivariate Analysis
									</div>
									<div class="meta">
										Three dimentional plots of the dataset.
									</div>
									<div class="col-dropdown ui form">
										<div class="field">
											<label>Axes</label>
											<select multiple="" class="ui fluid dropdown">
												<option value="">Select Axes</option>
											</select>
										</div>
										<div class="field">
											<label>Additional Column</label>
											<select class="ui fluid dropdown">
												<option value="">Select Additional Column</option>
											</select>
										</div>
									</div>
								</div>
								<div class="content missing-notice"></div>
								<div class="content has-menu">
									<div class="ui secondary pointing two item menu">
										<a class="active item">Bubble Chart</a>
										<a class="item">Stacked Column Chart</a>
										<a class="item">Heatmap</a>
										<a class="item">Scatter Plot</a>
										<a class="item">Grouped Column Chart</a>
										<a class="item">No Graph</a>
									</div>
									<div class="bubble-chart">
										<div class="chart image"></div>
										<div class="ui divider render"></div>
										<div class="toggle-container render">
											<div>Show All Data</div>
											<div class="render ui fitted toggle checkbox">
												<input type="checkbox">
												<label></label>
											</div>
										</div>
										<div class="meta render-detail"><i class="info circle icon"></i> Sample data is rendered by default.</div>
									</div>
									<div class="stacked-column-chart">
										<div class="chart image"></div>
									</div>
									<div class="heatmap">
										<div class="chart image"></div>
									</div>
									<div class="scatter-plot">
										<div class="chart image"></div>
									</div>
									<div class="grouped-column-chart">
										<div class="chart image"></div>
									</div>
									<div class="no-graph">No Graph to Show</div>
								</div>
							</div>
						</div>

						<div class="column multivariate">
							<div class="ui fluid card">
								<div class="content">
									<div class="header">
										Multivariate Analysis
									</div>
									<div class="meta">
										Inspection of multiple columns in the dataset.
									</div>
									<div class="col-dropdown">
										<select multiple="" class="ui fluid dropdown">
											<option value="">Select Column</option>
										</select>
									</div>
								</div>
								<div class="content missing-notice"></div>
								<div class="content has-menu">
									<div class="ui secondary pointing two item menu">
										<a class="active item">Parallel Coordinate</a>
										<a class="item">Heatmap</a>
									</div>
									<div class="parallel-coordinate">
										<div class="chart image"></div>
										<div class="ui divider render"></div>
										<div class="toggle-container render">
											<div>Show All Data</div>
											<div class="render ui fitted toggle checkbox">
												<input type="checkbox">
												<label></label>
											</div>
										</div>
										<div class="meta render-detail"><i class="info circle icon"></i> Sample data is rendered by default.</div>
									</div>
									<div class="heatmap">
										<div class="chart image"></div>
										<div class="ui divider"></div>
										<div class="toggle-container">
											<div>Independent Scales</div>
											<div class="scale ui fitted toggle checkbox">
												<input type="checkbox">
												<label></label>
											</div>
										</div>
										<div class="ui divider render"></div>
										<div class="toggle-container render">
											<div>Show All Data</div>
											<div class="render ui fitted toggle checkbox">
												<input type="checkbox">
												<label></label>
											</div>
										</div>
										<div class="meta render-detail"><i class="info circle icon"></i> Sample data is rendered by default.</div>
									</div>
								</div>
							</div>
						</div>

						<div class="column compare">
							<div class="ui fluid card">
								<div class="content">
									<div class="header">
										Comparison Analysis
									</div>
									<div class="meta">
										Comparison between multiple columns of data.
									</div>
									<div class="col-dropdown ui form">
										<div class="field"></div>
										<div class="field"></div>
									</div>
								</div>
								<div class="content missing-notice"></div>
								<div class="content has-menu">
									<div class="ui secondary pointing two item menu">
										<a class="active item">Area Plot</a>
										<a class="item">Multiple Line Chart</a>
									</div>
									<div class="area-plot">
										<div class="chart image"></div>
										<div class="ui divider"></div>
										<span>Number of Bins</span>
										<input class="ui range"></input>
									</div>
									<div class="multiple-line-chart">
										<div class="chart image"></div>
										<div class="reduce options">
											<div class="ui reduce divider"></div>
											<div class="toggle-container">
												<div>Reduce Duplicates</div>
											</div>
											<select class="ui fluid dropdown">
												<option value="mean">Average</option>
												<option value="median">Median</option>
												<option value="sum">Sum</option>
												<option value="variance">Variance</option>
												<option value="deviation">Standard Deviation</option>
											</select>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Different Graph Modules End Here -->
					</div>
				</div>
				<div class="ui dimmer">
					<div class="ui text loader"></div>
				</div>
			</div>
		</div>
	</div>

	<!-- Data Upload Modal -->
	<div class="ui modal upload">
	  <div class="header">
		Upload Data
	  </div>
	  <div class="content">
		<div class="description">
			<div class="box">
				<!-- Drag and Drop Box -->
				<div class="box__input">
					<svg class="box__icon" xmlns="http://www.w3.org/2000/svg" width="50" height="43" viewBox="0 0 50 43"><path d="M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z"></path></svg>
					<input class="box__file" type="file" name="files[]" id="file" multiple />
					<label for="file"><strong>Choose a file</strong><span class="box__dragndrop"> or drag it here</span>.</label>
				</div>

				<!-- State Indicators -->
				<div class="box__uploading">Uploading&hellip;</div>
				<div class="box__success">Done!</div>
				<div class="box__error">Error! <span></span> <br><br><button class="ui button box__restart">Try Again</button></div>
			</div>
		</div>
	  </div>
	  <div class="actions">
		<div class="ui black deny button">
		  Cancel
		</div>
	  </div>
	</div>

	<!-- Error Message Modal -->
	<div class="ui small modal errmsg">
		<div class="header">Error</div>
		<div class="content">
			<div class="description"></div>
		</div>
		<div class="actions">
			<div class="ui primary right ok button">
				OK
			</div>
		</div>
	</div>

	<!-- Export Modal -->
	<div class="ui small modal export">
		<div class="header">Export Graph</div>
		<div class="content">
			<div class="ui form" id="export-form">
				<div class="ui two fields">
					<div class="file name field">
						<label>File Name</label>
						<input name="file-name" type="text">
					</div>
					<div class="file format field">
						<label>File Format</label>
						<select name="file-format" class="ui selection dropdown">
							<option value="">Select File Format</option>
							<option value="svg">SVG</option>
							<option value="jpg">JPG</option>
							<option value="png">PNG</option>
						</select>
					</div>
				</div>
			</div>
			<button type="submit" class="hidden" form="export-form"></button>
			<div class="center ui">
				<canvas class="chart image"></canvas>
			</div>
		</div>
		<div class="actions">
			<div class="ui black deny button">
				Cancel
			</div>
			<div class="ui primary right button">
				OK
			</div>
		</div>
	</div>

	<!-- Loader -->
	<div class="ui active dimmer">
		<div class="ui text loader">Loading</div>
	</div>

</body>

<!-- jQuery -->
<script type="text/javascript" src="../assets/js/jquery-1.10.2.js"></script>

<!-- Semantic UI JS -->
<script type="text/javascript" src="../assets/js/semantic.min.js"></script>

<!-- Div Resize Event JS -->
<script type="text/javascript" src="../assets/js/resize.min.js"></script>

<!-- Masonry JS -->
<script type="text/javascript" src="../assets/js/masonry.min.js"></script>

<!-- Range Slider Plugin -->
<script type="text/javascript" src="../assets/js/range.min.js"></script>

<!-- D3 Visualization Library -->
<script type="text/javascript" src="../assets/js/d3.min.js"></script>

<!-- DSV Parsing JS -->
<script type="text/javascript" src="../assets/js/papaparse.min.js"></script>

<!-- Highcharts -->
<script type="text/javascript" src="../assets/js/highcharts.js"></script>
<script type="text/javascript" src="../assets/js/highcharts-more.js"></script>
<script type="text/javascript" src="../assets/js/highcharts-heatmap.js"></script>
<script type="text/javascript" src="../assets/js/highcharts-drilldown.js"></script>

<!-- Regression Library -->
<script type="text/javascript" src="../assets/js/regression.js"></script>

<!-- Progressive Rendering -->
<script type="text/javascript" src="../assets/js/render-queue.js"></script>

<!-- SVG to Canvas -->
<script type="text/javascript" src="../assets/js/canvg.min.js"></script>

<!-- Custom Script -->
<script type="text/javascript" src="script.js"></script>
<script type="text/javascript" src="drag-and-drop.js"></script>

<!-- Graph Types-->
<script src="graphs/basic.js" type="text/javascript"></script>

<script src="graphs/univariate.js" type="text/javascript"></script>
<script src="graphs/univariate/boxplot.js" type="text/javascript"></script>
<script src="graphs/univariate/histogram.js" type="text/javascript"></script>
<script src="graphs/univariate/piechart.js" type="text/javascript"></script>
<script src="graphs/univariate/columnchart.js" type="text/javascript"></script>

<script src="graphs/bivariate.js" type="text/javascript"></script>
<script src="graphs/bivariate/scatterplot.js" type="text/javascript"></script>
<script src="graphs/bivariate/heatmap.js" type="text/javascript"></script>
<script src="graphs/bivariate/linechart.js" type="text/javascript"></script>
<script src="graphs/bivariate/stackedhistogram.js" type="text/javascript"></script>
<script src="graphs/bivariate/donutchart.js" type="text/javascript"></script>
<script src="graphs/bivariate/stackedcolumnchart.js" type="text/javascript"></script>

<script src="graphs/trivariate.js" type="text/javascript"></script>
<script src="graphs/trivariate/bubblechart.js" type="text/javascript"></script>
<script src="graphs/trivariate/scatterplot.js" type="text/javascript"></script>
<script src="graphs/trivariate/heatmap.js" type="text/javascript"></script>
<script src="graphs/trivariate/stackedcolumnchart.js" type="text/javascript"></script>
<script src="graphs/trivariate/groupedcolumnchart.js" type="text/javascript"></script>

<script src="graphs/multivariate.js" type="text/javascript"></script>
<script src="graphs/multivariate/parallelcoordinate.js" type="text/javascript"></script>
<script src="graphs/multivariate/heatmap.js" type="text/javascript"></script>

<script src="graphs/compare.js" type="text/javascript"></script>
<script src="graphs/compare/areaplot.js" type="text/javascript"></script>
<script src="graphs/compare/multiplelinechart.js" type="text/javascript"></script>

<!-- Initialization Script -->
<script type="text/javascript">
	$(document).ready(function(){
		/* Hide all menus if url indicates embed mode */
		var encodedUrl = getParameterByName("url");
		if(encodedUrl != null) {
			$("body").css("background-color", "white");
			$(".full.height").css("background-color", "white");
			$(".main-content").css("margin", "0").css("background", "none");
			$(".toc").hide();
			$(".toc-copy").hide();
			$(".inverted.main.menu").hide();
			$(".header-content").hide();
		}

		/* Hide All Graphs */
		$(".graph-content > .column").addClass("hidden");

		/* Initialize Masonry */
		$(".masonry.grid").masonry({
			itemSelector: '.column:not(.ui):not(.not-masonry)',
			percentPosition: true
		});
		$('.masonry.grid .column').resize(function() {
			$(".masonry.grid").masonry('layout');
		});

		/* Show Body */
		$("body").show();

		/* Add sidebar animation */
		$(".launch.icon").click(function(){
			$(".sidebar.toc").sidebar('toggle');
		});

		/* Load Chart Types */
		var chartTypes = [];
		var chartTypeHtml = {};
		$(".graph-content > .column").each(function() {
			var classNames = $(this)
				.attr("class")
				.split(' ')
				.filter(function(val) {
					return val != "column"
						&& val != "hidden"
						&& val != "settings"
						&& val != "default-module";
				});
			for(var ix in classNames) {
				chartTypes.push(classNames[ix]);
				chartTypeHtml[classNames[ix]] = $(this).html();
			}
		});
		
		/* Populate Add Module Dropdown */
		chartTypes.forEach(function(type, ix) {
			function toTitleCase(txt) {
				return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
			}
			$(".settings .add.module.dropdown > .menu").append(
				"<div class='item' value='" + ix + "'>" + toTitleCase(type) + "</div>"
			);
		});
		$(".settings .add.module.dropdown").dropdown();
		$(".add.module.button:not(.dropdown)").click(function() {
			var chartType = $(".settings .add.module.dropdown").dropdown("get value");
			if(chartType == null) return;
			$(".graph-content").append(
				"<div class='column " + chartType + "'>"
				+ chartTypeHtml[chartType]
				+ "</div>"
			);
			var $moduleToDraw = $(".graph-content").children().last(".column");
			Dashboard.drawModule($moduleToDraw, chartType);
			$moduleToDraw.addControlButtons();
			$(".masonry.grid").masonry('appended', $moduleToDraw);
			$('.masonry.grid .column').resize(function() {
				$(".masonry.grid").masonry('layout');
			});
		});

		var downloadData = function(url) {
			Dashboard.progress.set(0);
			setTimeout(function() {
				$.ajax({
					type: 'GET',
					url: url,
					dataType: "text",
					success: function(raw) {
						drawCharts(raw);
					}
				});
			}, 1);
		};

		/* Define Draw Charts Function */
		var drawCharts = function(raw = null) {
			var parseFile = function() {
				return new Promise(function(resolve, reject) {
					Dashboard.progress.set(1);
					setTimeout(function() {
						if(Dashboard.init(raw, chartTypes)) {
							resolve();
						}
					}, 1);
				});
			};

			var generatePlots = function() {
				return new Promise(function(resolve, reject) {
					Dashboard.progress.set(2);
					setTimeout(function() {
						Dashboard.draw();
						resolve();
					}, 1);
				});
			};

			var finishUp = function() {
				return new Promise(function(resolve, reject) {
					Dashboard.progress.set(3);
					setTimeout(function() {
						$(".ui.look.button").click(function () {
							saveFile('data.txt', raw, 'text/csv');
						});
						$(".ui.look.button").removeClass("disabled");

						$(".column.settings").removeClass("hidden");

						$(".unfold.all.button").trigger("click");

						$(".masonry.grid").masonry('layout');

						$(".ui.modal").modal('hide');

						// show sample data notice if needed
						if($(".render.checkbox:not(.hidden)").length) {
							$(".sample-notice").removeClass("hidden");
						}

						resolve();
					}, 1);
				});
			};

			if(raw != null) {
				parseFile()
					.catch(function(e) {})
					.then(generatePlots)
					.then(finishUp);
			}
			else {
				generatePlots().then(finishUp);
			}
		};

		/* Download Functionality */
		var saveFile = function(filename, data, type) {
			var blob = new Blob([data], {type: type});
			if(window.navigator.msSaveOrOpenBlob) {
				window.navigator.msSaveBlob(blob, filename);
			}
			else{
				var elem = window.document.createElement('a');
				elem.href = window.URL.createObjectURL(blob);
				elem.target = '_blank';
				elem.download = filename;
				document.body.appendChild(elem);
				elem.click();        
				document.body.removeChild(elem);
			}
		};

		/* Data Selection Dropdown */
		$('.header-dropdown').dropdown('setting', 'onChange', function(){
			var newValue = $('.header-dropdown').dropdown('get value');
			$(".sample-notice").addClass("hidden");
			if(newValue == "upload") {
				DragAndDrop.init(drawCharts);
				$(".ui.upload.modal").modal('setting', {
					closable  	: false,
					onDeny		: function() {
						$(".header-dropdown").dropdown('restore defaults');
						$(".graph-content > .column:not(.settings)").addClass("hidden");
						$(".ui.look.button").addClass("disabled");
					}
				}).modal("show");
			}
			else if(newValue != "") {
				downloadData(newValue);
			}
		});

		/* Disable file upload option if necessary */
		var div = document.createElement('div');
		var isAdvancedUpload = (
			('draggable' in div) 
			|| ('ondragstart' in div && 'ondrop' in div)
		) && 'FormData' in window && 'FileReader' in window;
		if(!isAdvancedUpload) {
			$(".header-dropdown .item[data-value='upload']").addClass("disabled");
		}

		/* Function that analyzes url parameters */
		/* Code source: http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript */
		function getParameterByName(name, url) {
			if (!url) url = window.location.href;
			name = name.replace(/[\[\]]/g, "\\$&");
			var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
				results = regex.exec(url);
			if (!results) return null;
			if (!results[2]) return '';
			return decodeURIComponent(results[2].replace(/\+/g, " "));
		}

		/* Analyze url parameters, show visualizations if needed */
		if(encodedUrl != null) {
			var urlSource = decodeURIComponent(encodedUrl);
			downloadData(urlSource);
		}

		/* Add Customization Elements */
		$.fn.addControlButtons = function() {
			var customizationButtons = ""
			+	"<div style='position: absolute; top: 10px; right: 5px; display: block'>"
			+		"<i class='right floated close link icon close-module-button'></i>"
			+		"<i class='right floated circle link icon fold-module-button'></i>"
			+		"<i class='right floated save link icon export-graph-button'></i>"
			+	"</div>"
			;
			$(this).find(".fluid.card").prepend(customizationButtons);
			if($(this).hasClass("basic")) {
				$(this).find(".fluid.card .save.icon").addClass("disabled").removeClass("link");
			}
			$(this).find(".fold-module-button").on("click", function() {
				var $column = $(this).closest(".column");

				if($column.hasClass("folded")) {
					unfoldModule($column);
				}
				else {
					foldModule($column);
				}
			});
			$(this).find(".close-module-button").on("click", function() {
				var $column = $(this).closest(".column");
				if($column.hasClass("default-module")) {
					$column.addClass("hoarded");
				}
				else {
					$column.remove();
				}
				$(".masonry.grid").masonry('layout');
			});
			$(this).find(".link.export-graph-button").on("click", function() {
				var $chart = $(this).closest(".column").find(".content.has-menu > div:not(.menu):not(.hidden) .chart.image").find("svg").parent();
				var $canvas = $(".export.modal canvas");
				$.data($canvas.get(0), "svgdata", $chart.html());
				$canvas.attr("width", $canvas.width());
				$canvas.attr("height", $canvas.height());
				$canvas.css("display", "block");
				$canvas.css("margin", "auto");
				canvg($canvas.get(0), $chart.html());
				$(".export.modal .ui.dropdown").dropdown();
				$(".export.modal").modal("show");
			});
		};
		$(".graph-content > .column:not(.settings)").each(function() {
			$(this).addClass("default-module");
			$(this).addControlButtons();
		});

		/* Module Folding Mechanism */
		var foldModule = function($divToFold) {
			var $button = $divToFold.find(".fold-module-button");
			$button.addClass("thin");
			$divToFold.addClass("folded");
			var description = jQuery.data($divToFold[0], "module-data").description();
			$divToFold.find(".ui.card").prepend(
				"<div class='folding state content'><div class='header'>" 
				+ description 
				+ "</div></div>"
			);
		}
		var unfoldModule = function($divToUnfold) {
			var $button = $divToUnfold.find(".fold-module-button");
			$button.removeClass("thin");
			$divToUnfold.removeClass("folded");
			$divToUnfold.find(".folding.state.content").remove();
		}

		/* Settings Section Buttons Behavior */
		$(".fold.all.button").click(function() {
			$(".graph-content > .column:not(.settings)").each(function() {
				if(!$(this).hasClass("folded")) {
					foldModule($(this));
				}
			});
		});
		$(".unfold.all.button").click(function() {
			$(".graph-content > .column:not(.settings)").each(function() {
				if($(this).hasClass("folded")) {
					unfoldModule($(this));
				}
			});
		});
		$(".clear.modules.button").click(function() {
			$(".graph-content > .column:not(.settings)").each(function() {
				$(this).find(".close-module-button").trigger("click");
			});
		});
		$(".restore.default.button").click(function() {
			$(".graph-content > .column:not(.settings)").each(function() {
				$(this).removeClass("hoarded");
				if($(this).hasClass("default-module")) {
					if($(this).hasClass("folded")) {
						unfoldModule($(this));
					}
				}
				else {
					$(this).remove();
				}
			});
			Dashboard.progress.set(0);
			drawCharts();
			$(".masonry.grid").masonry('layout');
		});

		/* Export Module */
		$(".export.modal .ui.form").form({
			fields: {
				"file-name": "empty",
				"file-format": "empty"
			},
			onSuccess: function() {
				var format = $(".export.modal .ui.dropdown").dropdown("get value");
				var fileName = $(".export.modal input[name='file-name']").val();
				console.log(fileName);
				if(format == "svg") {
					var svgData = $.data($(".export.modal canvas").get(0), "svgdata");
					saveFile(fileName + ".svg", svgData, "image/svg+xml");
				}
				if(format == "png") {	
					var pngData = atob($(".export.modal canvas").get(0).toDataURL("image/png").split(',')[1]);
					var asArray = new Uint8Array(pngData.length);
					for( var i = 0, len = pngData.length; i < len; i++) {
						asArray[i] = pngData.charCodeAt(i);
					}
					saveFile(fileName + ".png", asArray.buffer, "image/png");
				}
				if(format == "jpg") {
					var jpgData = atob($(".export.modal canvas").get(0).toDataURL("image/jpeg", 1.0).split(',')[1]);
					var asArray = new Uint8Array(jpgData.length);
					for( var i = 0, len = jpgData.length; i < len; i++) {
						asArray[i] = jpgData.charCodeAt(i);
					}
					saveFile(fileName + ".jpg", asArray.buffer, "image/jpeg");
				}
				$(".export.modal").modal("hide");
			}
		});
		$(".export.modal .primary.button").click(function() {
			$(".export.modal .ui.form").submit();
		});
		$(".export.modal .deny.button").click(function() {
			$(".export.modal").modal("hide");
			$(".export.modal .form").form("reset");
		});

		$("body.dimmable > .ui.dimmer").removeClass("active");
	});
</script>

</html>